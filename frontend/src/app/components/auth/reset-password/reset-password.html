<section class="card" [class.card--success]="status() === 'success'">
  @if (status() === 'success' && message()) {
    <div class="success">
      <h1>Mot de passe mis à jour ✅</h1>
      <p>{{ message() }}</p>
      <a class="cta" routerLink="/login">Retourner à la connexion</a>
    </div>
  } @else {
    <h1>Réinitialiser votre mot de passe</h1>
    <p>
      Choisissez un nouveau mot de passe pour votre compte. Ce lien est sécurisé et valable pendant
      1 heure.
    </p>

    @if (!hasToken()) {
      <div class="status error">
        <p>Lien invalide ou expiré. Demandez un nouveau lien.</p>
        <a class="cta secondary" routerLink="/forgot-password">Demander un lien</a>
      </div>
    } @else {
      <form [formGroup]="form" (ngSubmit)="submit()" novalidate>
        <label for="password">Nouveau mot de passe</label>
        <input
          id="password"
          type="password"
          autocomplete="new-password"
          formControlName="password"
          [class.invalid]="form.controls.password.touched && form.controls.password.invalid"
        />
        @if (form.controls.password.touched && form.controls.password.hasError('required')) {
          <p class="hint error">Mot de passe requis.</p>
        } @else if (form.controls.password.touched && form.controls.password.hasError('minlength')) {
          <p class="hint error">8 caractères minimum.</p>
        }

        <label for="confirmPassword">Confirmation</label>
        <input
          id="confirmPassword"
          type="password"
          autocomplete="new-password"
          formControlName="confirmPassword"
          [class.invalid]="passwordsMismatch"
        />
        @if (passwordsMismatch) {
          <p class="hint error">Les mots de passe ne correspondent pas.</p>
        }

        <button type="submit" [disabled]="form.invalid || status() === 'loading'">
          Mettre à jour mon mot de passe
        </button>
      </form>
    }

    @if (status() === 'error' && hasToken() && message()) {
      <div class="status error">
        <p>{{ message() }}</p>
        <button type="button" (click)="resetForm()">Réessayer</button>
      </div>
    }
  }
</section>
